<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>수강생 설문 관리 - AI-X 시스템</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <!-- 헤더 -->
  <header class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <button onclick="goBackToMain()" class="text-gray-600 hover:text-gray-800 transition-colors mr-4">
            메인으로
          </button>
          <h1 class="text-xl font-bold text-gray-900">수강생 설문 관리</h1>
        </div>
        <div class="flex items-center space-x-4">
          <span class="text-gray-600">[운영자] 권회은</span>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-6xl mx-auto p-6">
    <!-- 통계 대시보드 헤더 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">사전 설문 관리</h2>
            <p class="text-gray-600">수강생들의 설문 응답을 확인하고 통계를 분석할 수 있습니다.</p>
          </div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-gray-600" id="completion-rate">
            24 / 30
          </div>
          <div class="text-sm text-gray-500">설문 완료 현황</div>
          <div class="text-xs text-gray-400 mt-1">
            완료율: <span id="completion-percentage">80</span>%
          </div>
        </div>
      </div>
    </div>

    <!-- 탭 메뉴 -->
    <div class="mb-6">
      <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
          <button onclick="switchTab('overview')" id="tab-overview" class="py-2 px-1 border-b-2 font-medium text-sm transition-colors border-indigo-500 text-gray-600">
            통계 개요
          </button>
          <button onclick="switchTab('responses')" id="tab-responses" class="py-2 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
            개별 응답
          </button>
        </nav>
      </div>
    </div>

    <!-- 통계 개요 탭 -->
    <div id="overview-tab" class="tab-content">
      <div class="space-y-8">
        <!-- 1행: 성별 분포, 컴퓨터 전공 여부 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">성별 분포</h3>
            <div class="h-64 relative">
              <canvas id="chart-gender"></canvas>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">컴퓨터 전공 여부</h3>
            <div class="h-64 relative">
              <canvas id="chart-computer-major"></canvas>
            </div>
          </div>
        </div>

        <!-- 2행: 파이썬 사전 학습, AI 경험 수준 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">파이썬 사전 학습 경험</h3>
            <div class="h-64 relative">
              <canvas id="chart-python-learning"></canvas>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">AI 경험 수준</h3>
            <div class="h-64 relative">
              <canvas id="chart-ai-experience"></canvas>
            </div>
          </div>
        </div>

        <!-- 3행: 프로그래밍 언어, 기술 스택 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">주요 프로그래밍 언어</h3>
            <div class="h-64 relative">
              <canvas id="chart-programming-languages"></canvas>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">보유 기술 스택</h3>
            <div class="h-64 relative">
              <canvas id="chart-tech-stack"></canvas>
            </div>
          </div>
        </div>

        <!-- 4행: 최근 프로젝트 역할, 학습 희망 분야 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">최근 프로젝트에서의 역할</h3>
            <div class="h-64 relative">
              <canvas id="chart-recent-role"></canvas>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">학습 희망 분야</h3>
            <div class="h-64 relative">
              <canvas id="chart-learning-fields"></canvas>
            </div>
          </div>
        </div>

        <!-- 5행: 선호 프로젝트 유형, MBTI 분포 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">선호하는 프로젝트 유형</h3>
            <div class="h-64 relative">
              <canvas id="chart-preferred-project"></canvas>
            </div>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">MBTI 성격 유형 분포</h3>
            <div class="h-64 relative">
              <canvas id="chart-mbti"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 개별 응답 탭 -->
    <div id="responses-tab" class="tab-content" style="display: none;">
      <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-gray-800">개별 응답 목록</h3>
          <div class="flex space-x-2">
            <input type="text" id="search-input" placeholder="이름으로 검색..." class="px-3 py-1 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <button onclick="searchStudents()" class="px-3 py-1 bg-indigo-600 text-white rounded-lg text-sm hover:bg-indigo-700 transition-colors">
              검색
            </button>
            <button onclick="resetFilters()" class="px-3 py-1 bg-gray-500 text-white rounded-lg text-sm hover:bg-gray-600 transition-colors">
              초기화
            </button>
          </div>
        </div>

        <!-- 필터링 옵션 -->
        <div class="mb-4 p-4 bg-gray-50 rounded-lg">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">AI 경험</label>
              <select id="filter-ai-experience" onchange="applyFilters()" class="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="">전체</option>
                <option value="none">전혀 모른다</option>
                <option value="chatgpt_basic">ChatGPT 기초</option>
                <option value="chatgpt_dev">개발 도구 사용</option>
                <option value="opensource">오픈소스 활용</option>
                <option value="expert">전문가 수준</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">성별</label>
              <select id="filter-gender" onchange="applyFilters()" class="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="">전체</option>
                <option value="male">남성</option>
                <option value="female">여성</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">전공 여부</label>
              <select id="filter-computer-major" onchange="applyFilters()" class="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="">전체</option>
                <option value="Y">전공자</option>
                <option value="N">비전공자</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 검색 결과 정보 -->
        <div class="mb-4 text-sm text-gray-600" id="search-results-info">
          전체 30명 중 24명 표시
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이름</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">이메일</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">전공여부</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">주요언어</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">최근 역할</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">더보기</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="students-table-body">
              <!-- 학생 데이터가 JavaScript로 동적 생성됨 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- 설문 상세 모달 -->
  <div id="survey-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
    <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <!-- 모달 헤더 -->
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-gray-800" id="modal-student-name">
            학생 설문 응답
          </h3>
          <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <!-- 설문 내용 -->
        <div id="modal-survey-content">
          <!-- 설문 상세 내용이 JavaScript로 동적 생성됨 -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // 현재 활성 탭
    let currentTab = 'overview';

    // 차트 인스턴스 저장
    const charts = {};

    // 차트 설정
    const chartConfigs = [
      { id: 'chart-gender', dataType: 'gender' },
      { id: 'chart-computer-major', dataType: 'computer_major' },
      { id: 'chart-python-learning', dataType: 'python_pre_learning' },
      { id: 'chart-ai-experience', dataType: 'ai_experience' },
      { id: 'chart-programming-languages', dataType: 'programming_languages' },
      { id: 'chart-tech-stack', dataType: 'tech_stack' },
      { id: 'chart-recent-role', dataType: 'recent_role' },
      { id: 'chart-learning-fields', dataType: 'learning_fields' },
      { id: 'chart-preferred-project', dataType: 'preferred_project_type' },
      { id: 'chart-mbti', dataType: 'mbti' }
    ];

    // 설문 통계 데이터 (React 컴포넌트와 동일한 구조)
    const surveyStatsData = {
      completed_surveys: 24,
      total_students: 30,
      completion_rate: 80
    };

    // 통계 데이터 (React 컴포넌트와 동일한 구조)
    const statisticsData = {
      total_responses: 24,
      statistics: {
        gender: {
          '남성': 14,
          '여성': 10
        },
        computer_major: {
          '전공자': 16,
          '비전공자': 8
        },
        python_pre_learning: {
          '있음': 18,
          '없음': 6
        },
        ai_experience: {
          '전혀 모름': 3,
          'ChatGPT 기초': 8,
          'ChatGPT 개발': 7,
          '오픈소스 활용': 4,
          '전문가 수준': 2
        },
        programming_languages: {
          'Python': 15,
          'JavaScript': 12,
          'Java': 8,
          '기타': 4
        },
        tech_stack: {
          '프론트엔드 (React, Vue 등)': 14,
          '백엔드 (Node.js, Spring 등)': 12,
          '데이터베이스 (MySQL, MongoDB 등)': 9,
          '인프라 (Docker, AWS 등)': 5,
          'AI (HuggingFace, API서비스 등)': 8
        },
        recent_role: {
          '팀 리더': 4,
          '개발자 (프론트)': 8,
          '개발자 (백엔드)': 6,
          '개발자 (AI)': 3,
          '데이터 분석': 2,
          '디자이너': 1
        },
        mbti: {
          'ENFP': 3, 'ISTJ': 2, 'ENTP': 4, 'INFP': 2,
          'ESTP': 3, 'ISFJ': 1, 'ENTJ': 2, 'INTP': 1,
          'ESFP': 2, 'ISFP': 1, 'ESTJ': 1, 'INFJ': 1, 'ESFJ': 1
        },
        preferred_project_type: {
          '강의 형식': 8,
          '기업 플젝': 10,
          '자율 플젝': 6
        },
        learning_fields: {
          '백엔드': 12,
          '프론트엔드': 14,
          'AI': 10,
          '데이터 분석': 6,
          '인프라': 4
        }
      }
    };

    // 개별 응답 데이터
    const individualResponsesData = {
      total_students: 30,
      filtered_students: 24,
      students: [
        {
          user_id: 1,
          name: '김민수',
          email: 'kim.minsu@example.com',
          computer_major: '전공자',
          main_language: 'Python',
          recent_role: '개발자 (백엔드)',
          survey_completed: true,
          survey_data: {
            name: '김민수',
            email: 'kim.minsu@example.com',
            gender: 'male',
            mbti: 'ENFP',
            computer_major: 'Y',
            python_pre_learning: 'Y',
            ai_experience: 'chatgpt_dev',
            programming_languages: ['Python', 'JavaScript'],
            tech_stack: ['백엔드 (Node.js, Spring 등)', 'AI (HuggingFace, API서비스 등)'],
            preferred_project_type: 'company',
            learning_fields: ['백엔드', 'AI'],
            desired_job: '백엔드 개발자',
            previous_course: '없음',
            skill_description: '웹 개발 2년 경험',
            career_details: '스타트업에서 백엔드 개발',
            goal_description: 'AI 융합 서비스 개발',
            course_questions: 'AI 실무 프로젝트 경험 희망'
          }
        },
        {
          user_id: 2,
          name: '박지영',
          email: 'park.jiyoung@example.com',
          computer_major: '비전공자',
          main_language: 'JavaScript',
          recent_role: '개발자 (프론트)',
          survey_completed: true,
          survey_data: {
            name: '박지영',
            email: 'park.jiyoung@example.com',
            gender: 'female',
            mbti: 'ISTJ',
            computer_major: 'N',
            python_pre_learning: 'N',
            ai_experience: 'chatgpt_basic',
            programming_languages: ['JavaScript', 'Python'],
            tech_stack: ['프론트엔드 (React, Vue 등)', '데이터베이스 (MySQL, MongoDB 등)'],
            preferred_project_type: 'lecture',
            learning_fields: ['프론트엔드', '데이터 분석'],
            desired_job: '풀스택 개발자',
            previous_course: 'AI-X 2기',
            skill_description: 'React 기반 웹 개발',
            career_details: '프리랜서 프론트엔드 개발',
            goal_description: 'AI 기능이 포함된 웹 서비스 개발',
            course_questions: 'AI API 연동 방법 학습 희망'
          }
        },
        {
          user_id: 3,
          name: '이준호',
          email: 'lee.junho@example.com',
          computer_major: '전공자',
          main_language: 'Java',
          recent_role: '팀 리더',
          survey_completed: true,
          survey_data: {
            name: '이준호',
            email: 'lee.junho@example.com',
            gender: 'male',
            mbti: 'ENTJ',
            computer_major: 'Y',
            python_pre_learning: 'Y',
            ai_experience: 'opensource',
            programming_languages: ['Java', 'Python'],
            tech_stack: ['백엔드 (Node.js, Spring 등)', '인프라 (Docker, AWS 등)'],
            preferred_project_type: 'self_directed',
            learning_fields: ['백엔드', '인프라'],
            desired_job: 'AI 엔지니어',
            previous_course: '없음',
            skill_description: 'Java Spring 5년 경험',
            career_details: 'SI 기업에서 팀장 역할',
            goal_description: 'MLOps 엔지니어로 전환',
            course_questions: 'AI 모델 배포 및 운영 학습'
          }
        }
      ]
    };

    // 필터 상태
    let currentFilters = {
      aiExperience: '',
      gender: '',
      computerMajor: '',
      searchName: ''
    };

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      initializeCharts();
      renderStudentsTable();
    });

    // 탭 전환
    function switchTab(tab) {
      currentTab = tab;

      // 탭 버튼 상태 업데이트
      document.getElementById('tab-overview').className = tab === 'overview'
        ? 'py-2 px-1 border-b-2 font-medium text-sm transition-colors border-indigo-500 text-gray-600'
        : 'py-2 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';

      document.getElementById('tab-responses').className = tab === 'responses'
        ? 'py-2 px-1 border-b-2 font-medium text-sm transition-colors border-indigo-500 text-gray-600'
        : 'py-2 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';

      // 탭 컨텐츠 표시/숨김
      document.getElementById('overview-tab').style.display = tab === 'overview' ? 'block' : 'none';
      document.getElementById('responses-tab').style.display = tab === 'responses' ? 'block' : 'none';

      console.log('설문 관리 탭 변경:', tab);
    }

    // 차트 초기화
    function initializeCharts() {
      chartConfigs.forEach(config => {
        const canvas = document.getElementById(config.id);
        if (canvas) {
          const ctx = canvas.getContext('2d');
          const chartType = getChartType(config.dataType);
          const chartData = generateChartData(config.dataType);

          charts[config.id] = new Chart(ctx, {
            type: chartType,
            data: chartData,
            options: getChartOptions(chartType)
          });
        }
      });
    }

    // 차트 업데이트 (더 이상 사용하지 않음 - 드롭다운 제거로 인해)
    function updateChart(chartId, dataType) {
      // 이 함수는 더 이상 사용되지 않습니다.
      console.log('updateChart 함수는 더 이상 사용되지 않습니다.');
    }

    // 차트 타입 결정
    function getChartType(dataType) {
      switch (dataType) {
        case 'gender':
        case 'computer_major':
        case 'python_pre_learning':
          return 'pie';
        case 'mbti':
          return 'doughnut';
        default:
          return 'bar';
      }
    }

    // 차트 데이터 생성
    function generateChartData(dataType) {
      const colors = {
        primary: ['#3B82F6', '#EC4899', '#10B981', '#F59E0B', '#8B5CF6'],
        doughnut: ['#3B82F6', '#EC4899', '#10B981', '#F59E0B', '#8B5CF6', '#EF4444', '#06B6D4', '#84CC16', '#F97316', '#A855F7']
      };

      if (!statisticsData || statisticsData.total_responses === 0) {
        return {
          labels: ['데이터 없음'],
          datasets: [{
            data: [1],
            backgroundColor: ['#E5E7EB'],
            borderWidth: 0,
            label: '응답 없음'
          }]
        };
      }

      const dataSource = statisticsData.statistics[dataType] || {};
      const labels = Object.keys(dataSource);
      const values = Object.values(dataSource);

      if (dataType === 'mbti') {
        return {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors.doughnut.slice(0, labels.length),
            borderWidth: 0
          }]
        };
      } else if (['ai_experience', 'programming_languages', 'tech_stack', 'recent_role', 'preferred_project_type', 'learning_fields'].includes(dataType)) {
        return {
          labels: labels,
          datasets: [{
            label: '응답자 수',
            data: values,
            backgroundColor: colors.primary.slice(0, labels.length),
            borderRadius: 4
          }]
        };
      } else {
        return {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors.primary.slice(0, labels.length),
            borderWidth: 0
          }]
        };
      }
    }

    // 차트 옵션 설정
    function getChartOptions(chartType) {
      const baseOptions = {
        responsive: true,
        maintainAspectRatio: false
      };

      if (chartType === 'pie' || chartType === 'doughnut') {
        return {
          ...baseOptions,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 15,
                usePointStyle: true,
                font: {
                  size: 11
                }
              }
            }
          }
        };
      } else {
        return {
          ...baseOptions,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            },
            x: {
              ticks: {
                font: {
                  size: 10
                }
              }
            }
          }
        };
      }
    }

    // 학생 테이블 렌더링
    function renderStudentsTable() {
      const tbody = document.getElementById('students-table-body');
      let filteredStudents = individualResponsesData.students;

      // 필터 적용
      if (currentFilters.searchName) {
        filteredStudents = filteredStudents.filter(student =>
          student.name.toLowerCase().includes(currentFilters.searchName.toLowerCase())
        );
      }

      if (currentFilters.aiExperience) {
        filteredStudents = filteredStudents.filter(student =>
          student.survey_data && student.survey_data.ai_experience === currentFilters.aiExperience
        );
      }

      if (currentFilters.gender) {
        filteredStudents = filteredStudents.filter(student =>
          student.survey_data && student.survey_data.gender === currentFilters.gender
        );
      }

      if (currentFilters.computerMajor) {
        filteredStudents = filteredStudents.filter(student =>
          student.survey_data && student.survey_data.computer_major === currentFilters.computerMajor
        );
      }

      // 테이블 HTML 생성
      tbody.innerHTML = filteredStudents.map(student => `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            ${student.name}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${student.email}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
              student.computer_major === '전공자'
                ? 'bg-blue-100 text-gray-800'
                : student.computer_major === '비전공자'
                ? 'bg-gray-100 text-gray-800'
                : 'bg-red-100 text-red-800'
            }">
              ${student.computer_major}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${student.main_language}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${student.recent_role}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            ${student.survey_completed ? `
              <button onclick="showStudentDetail(${student.user_id})" class="text-gray-600 hover:text-gray-900 transition-colors">
                더보기
              </button>
            ` : `
              <span class="text-gray-400">미완료</span>
            `}
          </td>
        </tr>
      `).join('');

      // 검색 결과 정보 업데이트
      document.getElementById('search-results-info').textContent =
        `전체 ${individualResponsesData.total_students}명 중 ${filteredStudents.length}명 표시${
          currentFilters.searchName ? ` (검색: "${currentFilters.searchName}")` : ''
        }`;
    }

    // 검색 실행
    function searchStudents() {
      const searchInput = document.getElementById('search-input').value;
      currentFilters.searchName = searchInput.trim();
      renderStudentsTable();
      console.log('검색 실행:', currentFilters.searchName);
    }

    // 필터 적용
    function applyFilters() {
      currentFilters.aiExperience = document.getElementById('filter-ai-experience').value;
      currentFilters.gender = document.getElementById('filter-gender').value;
      currentFilters.computerMajor = document.getElementById('filter-computer-major').value;
      renderStudentsTable();
      console.log('필터 변경:', currentFilters);
    }

    // 필터 초기화
    function resetFilters() {
      document.getElementById('search-input').value = '';
      document.getElementById('filter-ai-experience').value = '';
      document.getElementById('filter-gender').value = '';
      document.getElementById('filter-computer-major').value = '';

      currentFilters = {
        aiExperience: '',
        gender: '',
        computerMajor: '',
        searchName: ''
      };

      renderStudentsTable();
      console.log('필터 및 검색 초기화');
    }

    // 학생 상세 정보 표시
    function showStudentDetail(userId) {
      const student = individualResponsesData.students.find(s => s.user_id === userId);
      if (!student || !student.survey_data) return;

      const modal = document.getElementById('survey-detail-modal');
      const modalTitle = document.getElementById('modal-student-name');
      const modalContent = document.getElementById('modal-survey-content');

      modalTitle.textContent = `${student.name}님의 설문 응답`;

      const aiExperienceMap = {
        'none': '전혀 모름',
        'chatgpt_basic': 'ChatGPT 기초',
        'chatgpt_dev': 'ChatGPT 개발',
        'opensource': '오픈소스 활용',
        'expert': '전문가 수준'
      };

      const projectTypeMap = {
        'lecture': '강의 형식',
        'company': '기업 플젝',
        'self_directed': '자율 플젝'
      };

      modalContent.innerHTML = `
        <div class="space-y-6">
          <!-- 기본 정보 -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="font-semibold text-gray-800 mb-3">기본 정보</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div><span class="font-medium">이름:</span> ${student.survey_data.name}</div>
              <div><span class="font-medium">이메일:</span> ${student.survey_data.email}</div>
              <div><span class="font-medium">성별:</span> ${student.survey_data.gender === 'male' ? '남성' : '여성'}</div>
              <div><span class="font-medium">MBTI:</span> ${student.survey_data.mbti}</div>
              <div><span class="font-medium">컴퓨터 전공:</span> ${student.survey_data.computer_major === 'Y' ? '전공자' : '비전공자'}</div>
              <div><span class="font-medium">파이썬 사전 학습:</span> ${student.survey_data.python_pre_learning === 'Y' ? '있음' : '없음'}</div>
            </div>
          </div>

          <!-- 경험 정보 -->
          <div class="bg-blue-50 rounded-lg p-4">
            <h4 class="font-semibold text-gray-800 mb-3">경험 정보</h4>
            <div class="space-y-3 text-sm">
              <div><span class="font-medium">AI 경험 수준:</span> ${aiExperienceMap[student.survey_data.ai_experience] || student.survey_data.ai_experience}</div>
              <div><span class="font-medium">프로그래밍 언어:</span> ${student.survey_data.programming_languages?.join(', ') || '없음'}</div>
              <div><span class="font-medium">기술 스택:</span> ${student.survey_data.tech_stack?.join(', ') || '없음'}</div>
              <div><span class="font-medium">최근 프로젝트 역할:</span> ${student.recent_role}</div>
            </div>
          </div>

          <!-- 목표 정보 -->
          <div class="bg-green-50 rounded-lg p-4">
            <h4 class="font-semibold text-gray-800 mb-3">목표 정보</h4>
            <div class="space-y-3 text-sm">
              <div><span class="font-medium">선호 프로젝트 유형:</span> ${projectTypeMap[student.survey_data.preferred_project_type] || student.survey_data.preferred_project_type}</div>
              <div><span class="font-medium">학습 희망 분야:</span> ${student.survey_data.learning_fields?.join(', ') || '없음'}</div>
              <div><span class="font-medium">희망 직무:</span> ${student.survey_data.desired_job}</div>
            </div>
          </div>

          <!-- 추가 정보 -->
          <div class="bg-yellow-50 rounded-lg p-4">
            <h4 class="font-semibold text-gray-800 mb-3">추가 정보</h4>
            <div class="space-y-3 text-sm">
              <div><span class="font-medium">이전 수료 과정:</span> ${student.survey_data.previous_course}</div>
              ${student.survey_data.skill_description ? `<div><span class="font-medium">기술 역량 설명:</span> ${student.survey_data.skill_description}</div>` : ''}
              ${student.survey_data.career_details ? `<div><span class="font-medium">경력 사항:</span> ${student.survey_data.career_details}</div>` : ''}
              ${student.survey_data.goal_description ? `<div><span class="font-medium">목표 설명:</span> ${student.survey_data.goal_description}</div>` : ''}
              ${student.survey_data.course_questions ? `<div><span class="font-medium">과정 질문:</span> ${student.survey_data.course_questions}</div>` : ''}
            </div>
          </div>
        </div>
      `;

      modal.classList.remove('hidden');
    }

    // 모달 닫기
    function closeModal() {
      document.getElementById('survey-detail-modal').classList.add('hidden');
    }

    // 메인으로 돌아가기
    function goBackToMain() {
      const currentCohort = localStorage.getItem('currentCohort') || 'ai-x-3rd';
      window.location.href = `main.html?cohort=${currentCohort}`;
    }

    // 엔터키로 검색
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && e.target.id === 'search-input') {
        searchStudents();
      }
    });

    // 모달 배경 클릭으로 닫기
    document.getElementById('survey-detail-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
</body>
</html>